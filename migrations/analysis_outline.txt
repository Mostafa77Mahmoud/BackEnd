ANALYSIS FILE STRUCTURE OUTLINE
===============================

Original File: app/routes/analysis.py
Total Lines: 862 lines
Analysis Date: 2025-09-14

ROUTE MAPPING ANALYSIS:
======================

Line Range  | Route                                    | Method | Function Name           | Primary Purpose
-----------|------------------------------------------|--------|-------------------------|------------------
31-323     | /analyze                                 | POST   | analyze_contract        | Main contract analysis
324-383    | /analysis/<analysis_id>                  | GET    | get_analysis_results    | Retrieve analysis results  
384-423    | /session/<session_id>                    | GET    | get_session_details     | Get session information
424-456    | /terms/<session_id>                      | GET    | get_session_terms       | Retrieve extracted terms
457-490    | /sessions                                | GET    | get_sessions            | List all sessions
491-524    | /history                                 | GET    | get_analysis_history    | Analysis history
525-569    | /statistics                              | GET    | get_statistics          | System statistics
570-614    | /stats/user                              | GET    | get_user_stats          | User-specific stats
615-711    | /preview_contract/<id>/<type>           | GET    | preview_contract        | Generate PDF preview
712-775    | /download_pdf_preview/<id>/<type>       | GET    | download_pdf_preview    | PDF download handler
776-855    | /feedback/expert                         | POST   | submit_expert_feedback  | Expert review submission
856-862    | /health                                  | GET    | health_check            | Health status

FUNCTIONAL GROUP ANALYSIS:
=========================

GROUP 1 - Upload & Analysis Processing (293 lines)
- Lines: 31-323
- Routes: /analyze
- Core Functionality: File upload, text extraction, AI analysis
- Dependencies: AI service, database, file processing

GROUP 2 - Data Retrieval & Terms (196 lines)  
- Lines: 324-456
- Routes: /analysis/<id>, /session/<id>, /terms/<id>
- Core Functionality: Session and analysis result retrieval
- Dependencies: Database queries, data formatting

GROUP 3 - Session Management (68 lines)
- Lines: 457-524  
- Routes: /sessions, /history
- Core Functionality: Session listing and history
- Dependencies: Database pagination, date formatting

GROUP 4 - Analytics & Admin (170 lines)
- Lines: 525-614, 776-855, 856-862
- Routes: /statistics, /stats/user, /feedback/expert, /health
- Core Functionality: System metrics, admin operations
- Dependencies: Database aggregation, expert feedback

GROUP 5 - Document Generation (160 lines)
- Lines: 615-775
- Routes: /preview_contract/<id>/<type>, /download_pdf_preview/<id>/<type>
- Core Functionality: PDF generation and download
- Dependencies: Template rendering, cloud storage

SHARED UTILITIES IDENTIFIED:
============================

1. Temporary file setup (lines 23-28)
2. Database collection getters (imported)
3. Logging configuration (logger setup)
4. Common error handling patterns
5. JSON response formatting utilities

SPLIT STRATEGY RECOMMENDATION:
=============================

Split into 5 focused modules:
1. analysis_upload.py - Upload and main analysis (GROUP 1)
2. analysis_terms.py - Data retrieval operations (GROUP 2)  
3. analysis_session.py - Session management (GROUP 3)
4. analysis_admin.py - Admin and statistics (GROUP 4)
5. analysis_generation.py - PDF operations (GROUP 5)

Benefits:
- Each module under 300 lines
- Clear separation of concerns
- Logical functional grouping
- Maintained route structure
- Single blueprint coordination