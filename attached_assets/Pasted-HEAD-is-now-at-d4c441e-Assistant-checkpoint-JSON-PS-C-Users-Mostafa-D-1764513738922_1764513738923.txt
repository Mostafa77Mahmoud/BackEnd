HEAD is now at d4c441e Assistant checkpoint: تحسين جميع ملفات البرومبت مع JSON PS C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd>      
PS C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd>      
PS C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd>      

PS C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd>      


PS C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd>      

PS C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd>      
PS C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd>      
PS C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd> python run.py       
 * Serving Flask app 'app'
 * Debug mode: on
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.3:5000
Press CTRL+C to quit
127.0.0.1 - - [30/Nov/2025 16:40:56] "OPTIONS /analyze HTTP/1.1" 200 -
Attempting to download from URL: https://res.cloudinary.com/dr6jicgld/image/upload/v1764513659/shariaa_analyzer_uploads/dce03fde-37b1-4b8e-adbc-dd374b09ed6c/original_contracts/original_qd_by_syr_m_lHtfZ_blmlky_lHyn_sdd_kml_lthmn_9f388e.pdf
File successfully downloaded to temporary path: C:\Users\Mostafa\AppData\Local\Temp\shariaa_analyzer_temp\processing_files\tmpryudmn3i.pdf
[2025-11-30 16:41:15] [INFO] [app.services.file_search] FileSearchService initialized using API Key: ****FYNQ
[2025-11-30 16:41:15] [INFO] [app.services.file_search] Model: gemini-2.5-flash
[2025-11-30 16:41:15] [INFO] [app.services.file_search] ============================================================
[2025-11-30 16:41:15] [INFO] [app.services.file_search] FILE SEARCH STORE INITIALIZATION
[2025-11-30 16:41:15] [INFO] [app.services.file_search] ============================================================
[2025-11-30 16:41:15] [INFO] [app.services.file_search] Creating new File Search Store...
[2025-11-30 16:41:15] [ERROR] [app.services.file_search] Failed to create File Search Store: 'Client' object has no attribute 'file_search_stores'
File search failed, proceeding without AAOIFI context: File Search Store not initialized.
Analysis failed for session dce03fde-37b1-4b8e-adbc-dd374b09ed6c: '\n    "term_id"'
Traceback (most recent call last):
  File "C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd\app\routes\analysis_upload.py", line 206, in analyze_file
    formatted_sys_prompt = sys_prompt.format(
                           ^^^^^^^^^^^^^^^^^^
KeyError: '\n    "term_id"'
127.0.0.1 - - [30/Nov/2025 16:41:15] "POST /analyze HTTP/1.1" 500 -
127.0.0.1 - - [30/Nov/2025 16:41:54] "OPTIONS /analyze HTTP/1.1" 200 -
Attempting to download from URL: https://res.cloudinary.com/dr6jicgld/image/upload/v1764513716/shariaa_analyzer_uploads/6d23cbb6-51e0-4a36-8252-f1f4411a4963/original_contracts/original_qd_by_syr_dd94c8.pdf
File successfully downloaded to temporary path: C:\Users\Mostafa\AppData\Local\Temp\shariaa_analyzer_temp\processing_files\tmpq11kls7r.pdf
Attempt 1 failed for extraction of C:\Users\Mostafa\AppData\Local\Temp\shariaa_analyzer_temp\processing_files\tmpq11kls7r.pdf: 403 PERMISSION_DENIED. {'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}
Attempt 2 failed for extraction of C:\Users\Mostafa\AppData\Local\Temp\shariaa_analyzer_temp\processing_files\tmpq11kls7r.pdf: 403 PERMISSION_DENIED. {'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}
Traceback (most recent call last):
  File "C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd\app\services\ai_service.py", line 189, in extract_text_from_file
    response = client.models.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\models.py", line 4942, in generate_content
    response = self._generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\models.py", line 3915, in _generate_content
    response_dict = self._api_client.request(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\_api_client.py", line 655, in request
    response = self._request(http_request, stream=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\_api_client.py", line 584, in _request
    errors.APIError.raise_for_response(response)
  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\errors.py", line 101, in raise_for_response
    raise ClientError(status_code, response_json, response)
google.genai.errors.ClientError: 403 PERMISSION_DENIED. {'error': {'code': 403,    response = self._request(http_request, stream=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\_api_client.py", line 584, in _request
    errors.APIError.raise_for_response(response)
  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\errors.py", line 101, in raise_for_response
    raise ClientError(status_code, response_json, response)
google.genai.errors.ClientError: 403 PERMISSION_DENIED. {'error': {'code': 403,               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\_api_client.py", line 584, in _request
    errors.APIError.raise_for_response(response)
  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\errors.py", line 101, in raise_for_response
    raise ClientError(status_code, response_json, response)
google.genai.errors.ClientError: 403 PERMISSION_DENIED. {'error': {'code': 403,  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\_api_client.py", line 584, in _request
    errors.APIError.raise_for_response(response)
  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\errors.py", line 101, in raise_for_response
    raise ClientError(status_code, response_json, response)
google.genai.errors.ClientError: 403 PERMISSION_DENIED. {'error': {'code': 403,ges\google\genai\_api_client.py", line 584, in _request
    errors.APIError.raise_for_response(response)
  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\errors.py", line 101, in raise_for_response
    raise ClientError(status_code, response_json, response)
google.genai.errors.ClientError: 403 PERMISSION_DENIED. {'error': {'code': 403,    errors.APIError.raise_for_response(response)
  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\errors.py", line 101, in raise_for_response
    raise ClientError(status_code, response_json, response)
google.genai.errors.ClientError: 403 PERMISSION_DENIED. {'error': {'code': 403,  File "C:\Users\Mostafa\AppData\Local\Programs\Python\Python312\Lib\site-packages\google\genai\errors.py", line 101, in raise_for_response
    raise ClientError(status_code, response_json, response)
google.genai.errors.ClientError: 403 PERMISSION_DENIED. {'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}
Failed extraction for C:\Users\Mostafa\AppData\Local\Temp\shariaa_analyzer_temp\processing_files\tmpq11kls7r.pdf after all retries.
Text extraction failed for .pdf
Analysis failed for session 6d23cbb6-51e0-4a36-8252-f1f4411a4963: Text extraction failed for .pdf.
    raise ClientError(status_code, response_json, response)
google.genai.errors.ClientError: 403 PERMISSION_DENIED. {'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}
Failed extraction for C:\Users\Mostafa\AppData\Local\Temp\shariaa_analyzer_temp\processing_files\tmpq11kls7r.pdf after all retries.
Text extraction failed for .pdf
Analysis failed for session 6d23cbb6-51e0-4a36-8252-f1f4411a4963: Text extraction failed for .pdf.
 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}
Failed extraction for C:\Users\Mostafa\AppData\Local\Temp\shariaa_analyzer_temp\processing_files\tmpq11kls7r.pdf after all retries.
Text extraction failed for .pdf
Analysis failed for session 6d23cbb6-51e0-4a36-8252-f1f4411a4963: Text extraction failed for .pdf.
Traceback (most recent call last):
  File "C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd\app\routes\analysis_upload.py", line 150, in analyze_file
    raise ValueError(f"Text extraction failed for {effective_ext}.")
ValueError: Text extraction failed for .pdf.
Text extraction failed for .pdf
Analysis failed for session 6d23cbb6-51e0-4a36-8252-f1f4411a4963: Text extraction failed for .pdf.
Traceback (most recent call last):
  File "C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd\app\routes\analysis_upload.py", line 150, in analyze_file
    raise ValueError(f"Text extraction failed for {effective_ext}.")
ValueError: Text extraction failed for .pdf.
Traceback (most recent call last):
  File "C:\Users\Mostafa\Downloads\BackEnd (Restrycterd+newENdPoints)\BackEnd\app\routes\analysis_upload.py", line 150, in analyze_file
    raise ValueError(f"Text extraction failed for {effective_ext}.")
ValueError: Text extraction failed for .pdf.
    raise ValueError(f"Text extraction failed for {effective_ext}.")
ValueError: Text extraction failed for .pdf.
127.0.0.1 - - [30/Nov/2025 16:42:01] "POST /analyze HTTP/1.1" 500 -



