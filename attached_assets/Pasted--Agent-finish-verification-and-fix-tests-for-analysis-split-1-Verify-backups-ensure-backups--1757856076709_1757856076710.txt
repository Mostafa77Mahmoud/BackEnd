(Agent) — finish verification and fix tests for analysis split

1) Verify backups: ensure backups/original_analysis.py exists. If it does not, restore from latest agent checkpoint or git. Do NOT delete backups.

2) Run pytest and produce full failure log:
   python -m pytest -q
   Save output to migrations/analysis_split_pytest.txt and paste here the file content.

3) Investigate the 3 failing tests:
   - For each failing test, include stack trace and one-line cause (mocking path or actual code bug).
   - Fix the issues (prefer minimal change: adjust import paths, fix the `sort()` call or its inputs, and update tests' mocks to point to new module paths).
   - Re-run pytest until all tests pass.

4) Smoke run the end-to-end sequence and save output:
   chmod +x ./scripts/smoke_test.sh && ./scripts/smoke_test.sh
   Save output to migrations/analysis_split_smoke.txt and paste it here.

5) Generate and paste these files (exact content):
   - migrations/analysis_outline.txt
   - migrations/analysis_split_plan.md
   - migrations/analysis_split_report.md
   - migrations/analysis_split_smoke.txt
   - migrations/analysis_split_pytest.txt
   - migrations/import_verification.txt (output of `python -c "import api_server, config, doc_processing, remote_api, utils; print(...)` test)
   - migrations/route_docstrings.md (collect route docstrings)

6) Provide checkpoint ID(s) and commit SHAs for:
   - backup commit
   - split commit
   - final checkpoint

7) Verify generate_from_brief:
   - Run one real call (curl) using a minimal brief and return the exact HTTP request and response (include returned JSON). Save response to migrations/generate_from_brief_example.json.
   - If a template exists, produce docx and pdf paths and confirm files are created.

8) Confirm prompts:
   - For each file in prompts/, confirm it starts with the exact header:
     AUTO-GENERATED by Agent — leave this line for future reference
     <!-- AGENT_CONTEXT_BLOCK_START -->
     (AGENT: keep this block; you may add repo-specific contextual hints)
     <!-- AGENT_CONTEXT_BLOCK_END -->
   - Save a checklist migrations/prompt_checklist.md marking OK/NeedsFix.

9) If any change required to fix tests or generate_from_brief, make minimal, well-documented commits. Create final checkpoint and return its ID.

Return here (paste) the contents of the above migration files and the final checkpoint ID. If any step fails, stop and paste the failing logs immediately.
