Context: Final micro-task for restructuring.
You already restructured the project and implemented endpoints. One remaining technical debt: `app/routes/analysis.py` is TOO BIG (~863 LOC). Split it safely into smaller route modules without changing public behavior or endpoints.

Hard rules (do not break these):
1. Preserve all public API URLs and docstrings exactly as they are (same path, method, request/response examples).
2. No behavioral changes. Any refactor must be strictly refactoring: move code, not change logic.
3. Create backups before deleting/moving: copy `app/routes/analysis.py` -> `backups/original_analysis.py` and commit.
4. After splitting, run smoke tests and unit tests. If any test fails, roll back the changes and report.
5. Create a machine-readable migration report `migrations/analysis_split_report.md` mapping original function/endpoint names/line ranges -> new file path and symbol.
6. Create an index `app/routes/__init__.py` that registers a single blueprint `analysis_bp` (or reuse existing) preserving `url_prefix='/api'` behavior.
7. Common helpers duplicated across new modules must be extracted into `app/utils/analysis_helpers.py` or `app/services/analysis_helpers.py`. Avoid code duplication.
8. Any files created for testing purposes must start with:
   # NOTE: This file is for testing purposes only

Deliverable files and structure (suggested — you can improve but follow spirit):
app/routes/
  ├─ analysis_upload.py        # upload + file/text entrypoints (POST /api/analyze, file handling)
  ├─ analysis_terms.py         # endpoints related to terms, extraction, term-level analysis
  ├─ analysis_session.py       # session/history endpoints (sessions, list/history)
  ├─ analysis_admin.py         # admin-like endpoints: stats, retrieval_debug, exported reports
  ├─ analysis_generation.py    # endpoints that generate modified contracts or previews (generate_modified_contract, generate_marked_contract, preview/download)
  ├─ __init__.py               # registers blueprint(s) and imports the modules
  ├─ utils.py                  # thin shim: route-specific helpers that call app/services
Notes:
- Names above are suggested. If you prefer different clear names, use them — but reflect names in the migration report.
- Keep each new file ~<200 LOC ideally.

Exact steps to perform (do them in order). Create a commit & checkpoint after each numbered step:

STEP 1 — Backup
- cp app/routes/analysis.py backups/original_analysis.py
- Commit: "chore: backup original app/routes/analysis.py before splitting"
- Create checkpoint.

STEP 2 — Static analysis & mapping
- Parse `app/routes/analysis.py` and produce an outline: list of endpoints, function names, associated route decorators, and line ranges. Save as `migrations/analysis_outline.txt`.
- Produce the proposed split mapping (which endpoints go to which new file). Save as `migrations/analysis_split_plan.md`.
- Commit: "chore: analysis.py outline and split plan"
- Create checkpoint.

STEP 3 — Implement split (safe)
- Create new files as per chosen split (e.g., analysis_upload.py, analysis_terms.py, etc).
- Move functions and route handlers into appropriate new files.
  - For any moved helper function referenced by multiple modules, extract to `app/utils/analysis_helpers.py` and import from there.
- In each new file:
  - Preserve original function docstring and route decorator.
  - Add `from flask import Blueprint` or import the shared `analysis_bp` from `app/routes/__init__.py` as per project convention.
  - Avoid circular imports: if needed, import late inside functions.
- In `app/routes/__init__.py`:
  - Create or update `analysis_bp = Blueprint('analysis', __name__)`.
  - Import the new modules to register handlers (e.g., `from . import analysis_upload, analysis_terms, ...`).
  - Ensure blueprint is registered in `app/__init__.py` with the same `url_prefix='/api'`.
- Commit: "refactor(routes): split analysis.py into smaller modules"
- Create checkpoint.

STEP 4 — Adjust imports & run quick static checks
- Run `python -m pyflakes .` or `python -m compileall .` to catch syntax/import errors.
- Fix any import issues (prefer late imports inside functions to avoid circular refs).
- Commit: "chore: fix imports after analysis split"
- Create checkpoint.

STEP 5 — Tests & smoke
- Run `./scripts/smoke_test.sh` (or run the sequence of curl commands).
- Run `pytest tests/test_endpoints_basic.py::TestBasicEndpoints -q`.
- Capture outputs to `migrations/analysis_split_smoke.txt` and `migrations/analysis_split_pytest.txt`.
- If any failure occurs, revert the last commit (the splitting commit) and restore previous state, then create a report `migrations/analysis_split_failure.txt` with logs and stop. (Do NOT delete backups).
- If tests pass, continue.

STEP 6 — Migration report
- Create `migrations/analysis_split_report.md` in YAML-like format mapping:
  - original_file: app/routes/analysis.py
  - backup: backups/original_analysis.py (commit SHA)
  - moved_endpoints:
    - endpoint: POST /api/analyze
      original_lines: 120-210
      new_file: app/routes/analysis_upload.py
      new_symbol: analyze_endpoint
    - ...
  - extracted_helpers:
    - helper_name: normalize_contract_text
      original_lines: 45-90
      new_file: app/utils/analysis_helpers.py
  - tests_run: true/false
  - smoke_test_path: migrations/analysis_split_smoke.txt
  - pytest_path: migrations/analysis_split_pytest.txt
- Commit: "docs: add analysis split migration report"
- Create final checkpoint.

STEP 7 — Clean up
- After TESTS PASS and after your checkpoint, you may remove the original `app/routes/analysis.py` file, but only:
  - Move it to `backups/original_analysis.py` (already done step 1),
  - THEN delete original file and commit: "chore: remove legacy analysis.py after successful split and tests".
- Do NOT permanently delete backups until user confirms.

Additional enforcement & checks:
- Ensure all route docstrings remain accessible. Provide a small script `scripts/collect_route_docs.py` (test-only; with top comment note) that extracts docstrings for `/api` routes and writes to `migrations/route_docstrings.md` — commit this script.
- Ensure `git diff` of the split commit is not huge in logic changes — it should be mostly moved code with minor import adjustments.
- Commit messages must be clear. Use the following example messages:
  - `chore: backup original app/routes/analysis.py`
  - `chore: analysis.py outline and split plan`
  - `refactor(routes): split analysis.py into analysis_upload.py, analysis_terms.py, analysis_session.py, analysis_admin.py, analysis_generation.py`
  - `chore: fix imports after analysis split`
  - `test: add smoke & pytest outputs for analysis split`
  - `docs: add analysis split migration report`

Final outputs to paste back here once you finish STEP 6:
1. Checkpoint ID or commit SHAs for the split commit and final checkpoint.
2. `migrations/analysis_outline.txt`
3. `migrations/analysis_split_plan.md`
4. `migrations/analysis_split_report.md`
5. `migrations/analysis_split_smoke.txt`
6. `migrations/analysis_split_pytest.txt`
7. `migrations/import_verification.txt` (from running the import script)
8. Any failures logs if tests failed.

Proceed now. If any single ambiguity arises (file X lacks clear boundaries for splitting), ask ONE focused question and then proceed. Do not alter endpoint paths or docstrings.
